<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Home</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Home</h1>

    



    


    <h3> </h3>










    




    <section>
        <article><h1>SMConfig v1.0</h1><p><a href="https://travis-ci.org/EgoAleSum/SMConfig"><img src="https://travis-ci.org/EgoAleSum/SMConfig.svg?branch=master" alt="Build Status"></a>
<a href="https://coveralls.io/github/EgoAleSum/SMConfig?branch=master"><img src="https://coveralls.io/repos/github/EgoAleSum/SMConfig/badge.svg?branch=master" alt="Coverage Status"></a>
<a href="https://david-dm.org/EgoAleSum/SMConfig"><img src="https://david-dm.org/EgoAleSum/SMConfig.svg?style=flat" alt="Dependency Status"></a>
<a href="https://david-dm.org/EgoAleSum/SMConfig#info=devDependencies"><img src="https://david-dm.org/EgoAleSum/SMConfig/dev-status.svg?style=flat" alt="devDependency Status"></a></p>
<p>Application configuration module for Node.js.</p>
<p>Features:</p>
<ul>
<li>Simple, yet flexible APIs</li>
<li>Automatic environment detection based on hostname</li>
<li>Override configuration at runtime with environmental variables or &quot;.env&quot; files</li>
<li>Load configuration from JSON, YAML and <a href="http://hjson.org">Hjson</a> documents</li>
<li>Plugin for Hapi 17+</li>
</ul>
<p>This code is licensed under the terms of the MIT license (see LICENSE.md).</p>
<h2>Add to your project</h2><p>Install from NPM:</p>
<pre class="prettyprint source lang-sh"><code>npm install --save smconfig</code></pre><h2>API Guide</h2><p>Include the module with:</p>
<pre class="prettyprint source lang-js"><code>const SMConfig = require('smconfig')</code></pre><p>The module exports a class named <code>SMConfig</code>.</p>
<h3>Constructor: SMConfig(config, env, options)</h3><pre class="prettyprint source lang-js"><code>const conf = new SMConfig(config, env, options)</code></pre><h4>Parameters</h4><ul>
<li><code>config</code>: configuration object (read below for description)</li>
<li><code>env</code>: when set, forces a specific environment</li>
<li><code>options</code>: dictionary with options:<ul>
<li><code>options.envVarName</code>: name of the environmental variable where options are passed (default: <code>SMCONFIG</code>)</li>
<li><code>options.flatten</code>: when true, configuration object is also flatened to &quot;dot notation&quot; (default: true)</li>
</ul>
</li>
</ul>
<p>The constructor determines the environment, then loads the configuration for the environment and stores it in the object.</p>
<h4>Config data</h4><p>The <strong><code>config</code></strong> paramter can either be a plain JavaScript object or the filename (as string) of a JSON, YAML or Hjson file. It is also possible to pass an array of filenames to load, which will be read in the sequence they are passed. File type is determined by the extension, and supported ones are: <code>*.json</code>, <code>*.yaml</code>, <code>*.yml</code> and <code>*.hjson</code>.</p>
<p>The configuration object must have the following basic structure:</p>
<pre class="prettyprint source lang-js"><code>const configData = {
    // Default configuration, for all environments
    default: {
        key1: 'value1',
        key2: 'value2'
    },

    // Each subsequent key is the name of the environment;
    // this can be anything you want
    dev: {
        // Custom environments inherit all keys from the default
        // environment, but can be overwritten here
        key1: 'override',
        newkey: 'helloworld'
    },
    production: {
        key1: 'override'
    },
    otherenvironment: {},

    // The hostnames object contains a list of hostnames that are
    // mapped to a specific environment.
    hostnames: {
        // Name of the environment, then list of hostnames
        dev: [
            'alessandro.localdomain'
        ],
        production: [
            // Can use * as wildcard
            '*.example.com',
            // Can also use RegExp objects
            /(.*?)\.example\.com$/i
        ]
    }
}

// Example:
const conf = new SMConfig(configData)</code></pre><h4>Load config data from files</h4><p>In place of a <code>config</code> object, you can pass a string with the path of a file to load with the config object. You can also pass an array of strings to specify multiple files, which will be merged in the order they're listed. If a configuration value is defined in multiple files, the value specified in the rightmost file will have the highest priority.</p>
<pre class="prettyprint source lang-js"><code>// Load a file
const obj = new SMConfig('config.json')

// Load multiple files
const obj = new SMConfig(['config.json', 'config2.yaml'])</code></pre><p>For sample configuration files in JSON, YAML and Hjson, check the documents in the test folder:</p>
<ul>
<li><a href="test/resources/testconfig.json">Sample JSON configuration</a></li>
<li><a href="test/resources/testconfig.yaml">Sample YAML configuration</a></li>
<li><a href="test/resources/testconfig.hjson">Sample Hjson configuration</a></li>
</ul>
<p>When using YAML, you can also use the following types that are not supported by JSON and Hjson: (see documentation for <a href="https://github.com/nodeca/js-yaml">js-yaml</a> for more information)</p>
<ul>
<li>RegExp: <code>!!js/regexp /pattern/gim</code></li>
<li>Functions: <code>!!js/function 'function () {...}'</code></li>
<li>Undefined: <code>!!js/undefined ''</code></li>
</ul>
<h4>Using environmental variables</h4><p>Configuration can also be passed at runtime (and it can override what is defined in the application or in the config files) with an environmental variable. The variable <code>SMCONFIG</code> (name can be changed with <strong><code>options.envVarName</code></strong>) can contain a set of key-values. You can also append <code>_1</code>, <code>_2</code>, etc, to pass multiple environmental variables. For example:</p>
<pre class="prettyprint source lang-sh"><code># SMConfig will store 'Passw0rd' for the 'databasePassword' key
SMCONFIG=&quot;databasePassword=Passw0rd&quot; \
  node myapp.js

# Nested properties can be passed too, for example `database.password`
SMCONFIG=&quot;database.password=Passw0rd&quot; \
  node myapp.js

# Multiple values can be passed
SMCONFIG=&quot;database.password=Passw0rd database.username=admin&quot; \
  node myapp.js

# You can add multiple environmental variable by appending `_#`
SMCONFIG=&quot;passphrase='hello world'&quot; \
  SMCONFIG_1=&quot;hello=world&quot; \
  SMCONFIG_2=&quot;a=b&quot; \
  node myapp.js

# If the value contains a space, quote it
SMCONFIG_1=&quot;passphrase='hello world'&quot; \
  SMCONFIG_2=&quot;secret=\&quot;psshhh\&quot;&quot; \
  node myapp.js</code></pre><p>You can also use the <code>SMCONFIG_FILE</code> (or <code>options.envVarName + '_FILE'</code>) to load a file with a list of values expressed as environmental variables. This is the same format of &quot;.env&quot; files, and can be used with <strong>Docker secrets</strong> as well.</p>
<p>A &quot;.env&quot; file has a list of config values expressed as <code>key=value</code>, separated by spacing characters (e.g. spaces or newlines). You can use single or double quotes to escape characters. Comments are not supported</p>
<p>Example of a &quot;.env&quot; file:</p>
<pre class="prettyprint source lang-text"><code>hello=world
quotes=&quot;required when using spaces&quot;
escape='it\'s my life'
nested.value=&quot;updated value in a nested object&quot;</code></pre><p>Example of loading the file:</p>
<pre class="prettyprint source lang-sh"><code># Loading the .env file
SMCONFIG_FILE=&quot;path/to/.env&quot; \
  node myapp.js

# This can be used with Docker secrets too
SMCONFIG_FILE=&quot;/run/secrets/env&quot; \
  node myapp.js</code></pre><h4>Environment</h4><p>The environment is determined by, in order:</p>
<ol>
<li>The value passed to the <strong><code>env</code></strong> parameter</li>
<li>The <code>process.env.NODE_ENV</code> environmental variable (when launching the application; for example: <code>$ NODE_ENV=production node myapp.js</code>)</li>
<li>The environment that is configured for the hostname (see below)</li>
<li>Fallback to the <code>default</code> environment</li>
</ol>
<h4>Flatten array</h4><p>When <strong><code>options.flatten</code></strong> is true, as per default value, the configuration data is also &quot;flattened&quot; into a dictionary that uses &quot;dot notation&quot;. For example, imagine the following configuration:</p>
<pre class="prettyprint source lang-js"><code>console.log(config.all)

// Output when
// options.flatten: false
{
    &quot;database&quot;: {
        &quot;host&quot;: &quot;db.example.com&quot;,
        &quot;username&quot;: &quot;admin&quot;,
        &quot;password&quot;: &quot;Passw0rd&quot;,
        &quot;ports&quot;: [8000, 8001]
    },
    &quot;otherkey&quot;: &quot;otherval&quot;
}

// Output when
// options.flatten: true
{
    &quot;database&quot;: {
        &quot;host&quot;: &quot;db.example.com&quot;,
        &quot;credentials&quot;: {
            &quot;username&quot;: &quot;admin&quot;,
            &quot;password&quot;: &quot;Passw0rd&quot;
        },
        &quot;ports&quot;: [8000, 8001]
    },
    &quot;database.host&quot;: &quot;db.example.com&quot;,
    &quot;database.credentials.username&quot;: &quot;admin&quot;,
    &quot;database.credentials.password&quot;: &quot;Passw0rd&quot;,
    &quot;database.ports&quot;: [8000, 8001],
    &quot;otherkey&quot;: &quot;otherval&quot;
}</code></pre><h3>SMConfig.get(key)</h3><pre class="prettyprint source lang-js"><code>// config is an instance of SMConfig
const databasePassword = config.get('databasePassword')

// If options.flatten is true, you can also access &quot;nested&quot; keys
const nested = config.get('database.credentials.password')</code></pre><p>Returns the value for the key passed as argument, reading from the configuration for the environment.</p>
<h3>SMConfig.environment</h3><pre class="prettyprint source lang-js"><code>// config is an instance of SMConfig
const env = config.environment</code></pre><p>The <strong><code>environment</code></strong> property, which is read-only, contains the name of the environment being used by the application.</p>
<h3>SMConfig.all</h3><pre class="prettyprint source lang-js"><code>// config is an instance of SMConfig
const allConfiguration = config.all</code></pre><p>The <strong><code>all</code></strong> property, which is read-only, contains all the configuration variables for the current environment.</p>
<h2>Hapi plugin</h2><p>This module offers an optional plugin for <a href="https://hapijs.com/">Hapi</a> (version 17 or higher required).</p>
<p>To use it, initialize the SMConfig object as normal, then register the plugin with Hapi passing the instance of SMConfig.</p>
<p>Example:</p>
<pre class="prettyprint source lang-js"><code>const SMConfig = require('smconfig')
const conf = new SMConfig(config, env, options)

await server.register({
    plugin: require('smconfig/plugins/hapi'),
    options: {config: conf}
})</code></pre></article>
    </section>






</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-getEnvironment.html">getEnvironment</a></li><li><a href="module-loadConfigFile.html">loadConfigFile</a></li><li><a href="module-parseEnvVar.html">parseEnvVar</a></li></ul><h3>Classes</h3><ul><li><a href="SMConfig.html">SMConfig</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>