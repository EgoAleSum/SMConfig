<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/getEnvironment.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/getEnvironment.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'

/**
 * @module getEnvironment
 */

const os = require('os')
const SMHelper = require('smhelper')

/**
 * Determines the environment to use.
 * 
 * 1. The value of the `env` parameter
 * 2. The value of `process.env.NODE_ENV`
 * 3. Determine the environment by looking up the machine's hostname.
 * 
 * The `hostnames` dictionary is a set of key-value pairs in which the key is the name
 * of the environment, and the value is an array of hostnames that are used for that
 * environment. Values can be strings (in which the * is used as glob for matching)
 * or regular expressions objects.
 * 
 * @param {string} [env] - If passed, this is the environment that will be used
 * @param {Object.&lt;string, Array.&lt;string|RegExp>>} [hostnames] - Dictionary in which 
 *        each key is the environment name, and the value is an array of hostnames
 *        to match.
 * @return {string} The environment to use
 */
function getEnvironment(env, hostnames) {
    // 1. The value passed in the `env` parameter
    env = env ? SMHelper.toStringSafe(env) : null
    if (env) {
        return env
    }

    // 2. The NODE_ENV environmental variable
    if (process.env.NODE_ENV) {
        // Variables in process.env are always strings
        return process.env.NODE_ENV
    }

    // 3. The environment that is configured for the hostname
    if (hostnames) {
        const hostname = os.hostname()

        for (const e in hostnames) {
            // Ensure the value is a non-empty array
            /* istanbul ignore else */
            if (hostnames.hasOwnProperty(e) &amp;&amp; hostnames[e] &amp;&amp; Array.isArray(hostnames[e])) {
                // Iterate through the list of hostnames
                for (const i in hostnames[e]) {
                    const v = hostnames[e][i]
                    if (!v) {
                        continue
                    }

                    if (typeof v == 'string') {
                        // Value is a string
                        if (SMHelper.strIs(v, hostname)) {
                            // Return the value from the function
                            return e
                        }
                    }
                    /* istanbul ignore else */
                    else if (v instanceof RegExp) {
                        // Value is a RegExp
                        if (v.test(hostname)) {
                            // Return the value from the function
                            return e
                        }
                    }
                }
            }
        }
    }

    // 4. Fallback to the default environment
    return 'default'
}

module.exports = getEnvironment
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-getEnvironment.html">getEnvironment</a></li><li><a href="module-loadConfigFile.html">loadConfigFile</a></li><li><a href="module-parseEnvVar.html">parseEnvVar</a></li></ul><h3>Classes</h3><ul><li><a href="SMConfig.html">SMConfig</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
